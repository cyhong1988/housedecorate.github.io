<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è£æ½¢é ç®—ç®¡ç†å¤§å¸« - é›²ç«¯åŒæ­¥ç‰ˆ</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --primary-color: #2c3e50;
            --accent-color: #d4af37;
            --text-main: #333;
            --text-sub: #7f8c8d;
            --danger: #e74c3c;
            --success: #27ae60;
            --border-radius: 12px;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
        }

        .container { width: 100%; max-width: 900px; }

        header { text-align: center; margin-bottom: 40px; }
        h1 { font-weight: 300; letter-spacing: 2px; color: var(--primary-color); margin-bottom: 10px; }

        .summary-dashboard {
            background: var(--primary-color);
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .summary-item .label { font-size: 0.9rem; opacity: 0.8; margin-bottom: 5px; }
        .summary-item .amount { font-size: 1.5rem; font-weight: 600; color: var(--accent-color); }

        .category-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f1f1f1;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .category-title { font-size: 1.2rem; font-weight: 600; color: var(--primary-color); display: flex; align-items: center; gap: 10px; }

        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input { padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--accent-color); }
        input.name-input, .edit-name { flex: 2; }
        input.price-input, .edit-price { flex: 1; }

        button { cursor: pointer; border: none; border-radius: 6px; transition: 0.3s; background: none; }
        .btn-add { background: var(--primary-color); color: white; padding: 10px 20px; }
        .btn-add:hover { background: #3e5871; }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: var(--text-sub); font-size: 0.85rem; padding: 10px; }
        td { padding: 12px 10px; border-bottom: 1px solid #eee; }

        .col-action { text-align: right; min-width: 100px; }
        .btn-edit { color: var(--text-sub); margin-right: 10px; font-size: 1rem; }
        .btn-edit:hover { color: var(--primary-color); }
        .btn-delete { color: #ccc; font-size: 1.2rem; }
        .btn-delete:hover { color: var(--danger); }
        .btn-save { color: var(--success); font-weight: bold; margin-right: 10px; }

        .empty-hint { text-align: center; color: #ccc; padding: 20px; font-style: italic; }
        .sync-status { font-size: 0.8rem; text-align: center; margin-top: -30px; margin-bottom: 20px; color: var(--text-sub); }

        @media (max-width: 600px) { .input-group { flex-direction: column; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>æ–°å®¶è£æ½¢é ç®—æ›¸</h1>
        <p style="color: var(--text-sub)">ç´°å¿ƒè¦åŠƒï¼Œæ‰“é€ ç†æƒ³çš„ç”Ÿæ´»ç©ºé–“</p>
    </header>

    <div class="sync-status" id="sync-status">é›²ç«¯åŒæ­¥ç‹€æ…‹ï¼šå¾…æ©Ÿ</div>

    <div class="summary-dashboard">
        <div class="summary-item">
            <div class="label">ç¸½é ç®—æ”¯å‡º</div>
            <div class="amount" id="grand-total">$ 0</div>
        </div>
        <div class="summary-item">
            <div class="label">å·¥ç¨‹ä½”æ¯”</div>
            <div class="amount" id="percent-eng">0%</div>
        </div>
        <div class="summary-item">
            <div class="label">å®¶é›»/å‚¢ä¿±ä½”æ¯”</div>
            <div class="amount" id="percent-other">0%</div>
        </div>
    </div>

    <section class="category-card" data-category="engineering">
        <div class="category-header">
            <div class="category-title"><span>ğŸ—ï¸</span> è£ä¿®å·¥ç¨‹é ç®—</div>
            <div class="subtotal">å°è¨ˆ: <span id="subtotal-engineering">$ 0</span></div>
        </div>
        <div class="input-group">
            <input type="text" class="name-input" placeholder="é …ç›®åç¨±...">
            <input type="number" class="price-input" placeholder="é‡‘é¡">
            <button class="btn-add" onclick="addItem('engineering')">æ–°å¢é …ç›®</button>
        </div>
        <table id="table-engineering">
            <thead><tr><th>é …ç›®åç¨±</th><th>é ä¼°é‡‘é¡</th><th class="col-action">æ“ä½œ</th></tr></thead>
            <tbody></tbody>
        </table>
    </section>

    <section class="category-card" data-category="appliances">
        <div class="category-header">
            <div class="category-title"><span>ğŸ“º</span> å®¶é›»è¨­å‚™é ç®—</div>
            <div class="subtotal">å°è¨ˆ: <span id="subtotal-appliances">$ 0</span></div>
        </div>
        <div class="input-group">
            <input type="text" class="name-input" placeholder="é …ç›®åç¨±...">
            <input type="number" class="price-input" placeholder="é‡‘é¡">
            <button class="btn-add" onclick="addItem('appliances')">æ–°å¢é …ç›®</button>
        </div>
        <table id="table-appliances">
            <thead><tr><th>é …ç›®åç¨±</th><th>é ä¼°é‡‘é¡</th><th class="col-action">æ“ä½œ</th></tr></thead>
            <tbody></tbody>
        </table>
    </section>

    <section class="category-card" data-category="furniture">
        <div class="category-header">
            <div class="category-title"><span>ğŸ›‹ï¸</span> å‚¢ä¿±è»Ÿè£é ç®—</div>
            <div class="subtotal">å°è¨ˆ: <span id="subtotal-furniture">$ 0</span></div>
        </div>
        <div class="input-group">
            <input type="text" class="name-input" placeholder="é …ç›®åç¨±...">
            <input type="number" class="price-input" placeholder="é‡‘é¡">
            <button class="btn-add" onclick="addItem('furniture')">æ–°å¢é …ç›®</button>
        </div>
        <table id="table-furniture">
            <thead><tr><th>é …ç›®åç¨±</th><th>é ä¼°é‡‘é¡</th><th class="col-action">æ“ä½œ</th></tr></thead>
            <tbody></tbody>
        </table>
    </section>
</div>

<script>
    // 1. è«‹åœ¨æ­¤è²¼ä¸Šä½ çš„ Google Apps Script éƒ¨ç½²ç¶²å€
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx0MvelMerRnzM8v7yN7RA-OcA4e0pSl9MO20FOSDJIbGml2yCiAz1qxSpvnVfDucbb/exec';

    let data = {
        engineering: [],
        appliances: [],
        furniture: []
    };

    // åŒæ­¥å‡½å¼
    async function syncToCloud(action, category, item) {
        if (GOOGLE_SCRIPT_URL === 'YOUR_GOOGLE_SCRIPT_WEB_APP_URL') return;
        
        const statusEl = document.getElementById('sync-status');
        statusEl.innerText = 'é›²ç«¯åŒæ­¥ä¸­...';
        statusEl.style.color = '#d4af37';

        try {
            await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ action, category, ...item })
            });
            statusEl.innerText = 'é›²ç«¯åŒæ­¥ç‹€æ…‹ï¼šå·²æ›´æ–°æ–¼ ' + new Date().toLocaleTimeString();
            statusEl.style.color = '#27ae60';
        } catch (e) {
            statusEl.innerText = 'é›²ç«¯åŒæ­¥å¤±æ•—';
            statusEl.style.color = '#e74c3c';
        }
    }

    function addItem(category) {
        const card = document.querySelector(`section[data-category="${category}"]`);
        const nameInp = card.querySelector('.name-input');
        const priceInp = card.querySelector('.price-input');

        if (!nameInp.value || !priceInp.value) return alert('è«‹è¼¸å…¥å®Œæ•´è³‡è¨Š');

        const newItem = {
            id: Date.now(),
            name: nameInp.value,
            price: parseFloat(priceInp.value)
        };

        data[category].push(newItem);
        syncToCloud('ADD', category, newItem);
        
        nameInp.value = '';
        priceInp.value = '';
        render();
    }

    function deleteItem(category, id) {
        if(!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤é …å—ï¼Ÿ')) return;
        data[category] = data[category].filter(i => i.id !== id);
        syncToCloud('DELETE', category, { id });
        render();
    }

    // é€²å…¥ç·¨è¼¯æ¨¡å¼
    function enterEditMode(category, id) {
        const item = data[category].find(i => i.id === id);
        const row = document.getElementById(`row-${id}`);
        row.innerHTML = `
            <td><input type="text" class="edit-name" value="${item.name}"></td>
            <td><input type="number" class="edit-price" value="${item.price}"></td>
            <td class="col-action">
                <button class="btn-save" onclick="saveEdit('${category}', ${id})">å„²å­˜</button>
                <button class="btn-delete" onclick="render()">å–æ¶ˆ</button>
            </td>
        `;
    }

    // å„²å­˜ç·¨è¼¯å…§å®¹
    function saveEdit(category, id) {
        const row = document.getElementById(`row-${id}`);
        const newName = row.querySelector('.edit-name').value;
        const newPrice = parseFloat(row.querySelector('.edit-price').value);

        const item = data[category].find(i => i.id === id);
        item.name = newName;
        item.price = newPrice;

        syncToCloud('UPDATE', category, item);
        render();
    }

    function formatCurrency(num) {
        return '$ ' + num.toLocaleString();
    }

    function render() {
        let grandTotal = 0;
        let subtotalMap = { engineering: 0, appliances: 0, furniture: 0 };

        for (let category in data) {
            const tbody = document.querySelector(`#table-${category} tbody`);
            tbody.innerHTML = '';

            if (data[category].length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" class="empty-hint">å°šç„¡é …ç›®</td></tr>`;
            }

            data[category].forEach(item => {
                subtotalMap[category] += item.price;
                const tr = document.createElement('tr');
                tr.id = `row-${item.id}`;
                tr.innerHTML = `
                    <td>${item.name}</td>
                    <td>${formatCurrency(item.price)}</td>
                    <td class="col-action">
                        <button class="btn-edit" onclick="enterEditMode('${category}', ${item.id})">âœ ç·¨è¼¯</button>
                        <button class="btn-delete" onclick="deleteItem('${category}', ${item.id})">Ã—</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById(`subtotal-${category}`).innerText = formatCurrency(subtotalMap[category]);
            grandTotal += subtotalMap[category];
        }

        document.getElementById('grand-total').innerText = formatCurrency(grandTotal);
        const engPercent = grandTotal > 0 ? Math.round((subtotalMap.engineering / grandTotal) * 100) : 0;
        const otherPercent = grandTotal > 0 ? Math.round(((subtotalMap.appliances + subtotalMap.furniture) / grandTotal) * 100) : 0;
        document.getElementById('percent-eng').innerText = engPercent + '%';
        document.getElementById('percent-other').innerText = otherPercent + '%';
    }

    render();
</script>

</body>
</html>

